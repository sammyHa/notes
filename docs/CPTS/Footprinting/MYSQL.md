---
title: MYSQL
date: 2024-10-30
tags: 
techniques: 
tools:
  - mysql
machines: 
difficulty: 
status: 
type: 
os: 
categories: 
exam-priority: 
time-invested:
---
>[!tip]- Tips
>Write tips here

### References
- Layered Enumeration Framework Guide
- Comprehensive OSCP Enumeration Strategies

**MySQL Overview**  
MySQL is an open-source SQL relational database management system (RDBMS) developed and supported by Oracle. It manages structured collections of data, ensuring fast processing and minimal storage. MySQL operates based on a client-server model, with the server handling data storage and distribution. Data is stored in tables containing various columns, rows, and data types. Databases are often stored in a single file (e.g., `wordpress.sql`).

---

**MySQL Clients**  
MySQL clients interact with the database using structured queries. They can insert, delete, modify, or retrieve data using SQL commands. Clients can access the database either through an internal network or the public internet, depending on the configuration. WordPress is a prime example of MySQL usage, storing posts, usernames, passwords, and other data in its database.

**Key SQL Operations:**

- Insert
- Delete
- Modify
- Retrieve

---

**MySQL Databases**  
MySQL is ideal for dynamic websites that require fast, efficient data retrieval. It is commonly used in the LAMP stack (Linux, Apache, MySQL, PHP) or LEMP (Linux, Nginx, MySQL, PHP). In web hosting, MySQL serves as a central instance where PHP scripts store content such as:

- Headers
- Texts
- Meta tags
- Customer data (e.g., usernames, emails, passwords)
- Links to files

Sensitive data like passwords are typically encrypted by PHP scripts using one-way encryption methods before being stored.

---

**MySQL Commands**  
MySQL translates SQL commands into executable code to perform actions such as:

- Displaying, modifying, adding, or deleting rows in tables
- Changing table structure
- Creating/deleting relationships, indexes
- Managing users

SQL errors, often triggered by SQL injections, provide valuable debugging information, which can sometimes reveal how the web application interacts with the database.

---

**MariaDB**  
MariaDB is a fork of MySQL, created after the original MySQL developer left Oracle and developed a new open-source RDBMS. MariaDB is compatible with MySQL but has some differences in performance and features.

---

**Default Configuration**  
Database management is a vast field that involves complexities, especially as databases scale in size. It requires dedicated roles like database administrators. Information security analysts and software developers also focus on database management in their roles. Experimenting with MySQL/MariaDB configurations helps build a deeper understanding of their functionality.

```shell
sudo apt install mysql-server -y
cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v "#" | sed -r '/^\s*$/d'
```
## Dangerous Settings

Many things can be misconfigured with MySQL. We can look in more detail at the [MySQL reference](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html) to determine which options can be made in the server configuration. The main options that are security-relevant are:

| **Settings**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | **Description**                                                                                              |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| `user`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Sets which user the MySQL service will run as.                                                               |
| `password`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Sets the password for the MySQL user.                                                                        |
| `admin_address`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | The IP address on which to listen for TCP/IP connections on the administrative network interface.            |
| `debug`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | This variable indicates the current debugging settings                                                       |
| `sql_warnings`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | This variable controls whether single-row INSERT statements produce an information string if warnings occur. |
| `secure_file_priv`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | This variable is used to limit the effect of data import and export operations.                              |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                              |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                              |
| **Security Risks in MySQL Configuration**<br><br>1. **Sensitive Settings (User, Password, Admin Address)**<br>    <br>    - **Plain Text Entries:** Settings like `user`, `password`, and `admin_address` are often stored in plain text within MySQL configuration files.<br>    - **File Permissions:** If the configuration file permissions are not set properly, unauthorized users may be able to access it. If an attacker gains file access or shell access, they can view the file and obtain the MySQL server credentials.<br>    - **Potential Impact:** If no additional security measures are in place, an attacker can gain full access to the MySQL database, including sensitive information such as customer data, email addresses, passwords, and personal details, and can even modify this data.<br>2. **Verbose Output (Debug and SQL Warnings)**<br>    <br>    - **Excessive Information:** The `debug` and `sql_warnings` settings provide verbose error messages that are helpful to administrators but pose a security risk if exposed.<br>    - **Sensitive Content in Errors:** These error messages can contain sensitive information, such as database structure, which attackers can use to identify vulnerabilities or further exploit the system.<br>    - **Potential Attack Surface:** Attackers could use this information in trial-and-error attacks to discover weaknesses or craft more sophisticated attacks, including SQL injection techniques that could be used to execute system commands on the server.<br>    - **Exposure in Web Applications:** Error messages are often displayed directly on web applications, making them a prime vector for exploitation. SQL injections can be manipulated to inject malicious commands, as demonstrated in SQL Injection Fundamentals and SQLMap Essentials. |                                                                                                              |
### Footprinting
scanning with [[Nmap]]
```shell
sudo nmap <ip> -sV -sC -p3306 --script mysql*

#mysql does not use and empty password for root. test 
mysql -u root -h <ip>
mysql -u root -pP4ssword -h <ip>
```
![[Pasted image 20241111004326.png]]

if we look at the existing databases we will see several already exist. The most important db for the mysql server are the `system schema (sys)` and `information schema (information_schema)` sys contians tables, information and metadata necessary for management. 

```shell
mysql> use sys;
mysql> show tables;
```
![[Pasted image 20241111004307.png]]

| **Command**                                          | **Description**                                                                                       |
| ---------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| `mysql -u <user> -p<password> -h <IP address>`       | Connect to the MySQL server. There should **not** be a space between the '-p' flag, and the password. |
| `show databases;`                                    | Show all databases.                                                                                   |
| `use <database>;`                                    | Select one of the existing databases.                                                                 |
| `show tables;`                                       | Show all available tables in the selected database.                                                   |
| `show columns from <table>;`                         | Show all columns in the selected database.                                                            |
| `select * from <table>;`                             | Show everything in the desired table.                                                                 |
| `select * from <table> where <column> = "<string>";` | Search for needed `string` in the desired table.                                                      |